<!DOCTYPE html>
<html>

<head>
	<title>CarbonNext CO2/CO sources and consumer map</title>
	<meta content="width=device-width, initial-scale=1.0" name="viewport">
	<meta charset="utf-8">
	<!-- Load Leaflet: instructions at http://leafletjs.com/download.html -->
	<link href="https://unpkg.com/leaflet@1.1.0/dist/leaflet.css" rel="stylesheet">
	<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js">
	</script>
	<!-- Load Omnivore plugin to convert CSV to GeoJSON format -->
	<script src='https://unpkg.com/csv2geojson@5.0.2/csv2geojson.js'>
	</script>
	<script src="/js/jquery-3.3.1.min.js">
	</script>
	<!-- Load d3: only for size legend for now -->
	<script src="//d3js.org/d3.v3.min.js">
	</script>
</head>

<body>
	<script>		

		/* Load all csv data files and create menu*/
		getChemparkData('Chemical parks', 'polyol plants europe v2.csv', "#CC7300");


		function getChemparkData(name, file, color) {			
			fetch(file)
				.then(response => response.text())
				.then(myBlob => convertCSV(myBlob));
		};

		function convertCSV(myBlob) {
			return new Promise((resolve, reject) => {
				csv2geojson.csv2geojson(myBlob, {
					latfield: 'latitude',
					lonfield: 'longitude',
					delimiter: ';',
				}, (err, geojson) => {
					if (err) {
						console.error(err);
						reject(err);
					} else {
						console.log(geojson);
						resolve(geojson);
					}
				});
			});
		};

		function getChemParkSize(potentials, feature){
			let size = Math.sqrt(potentials[feature.properties.FacilityName]["10000"]["CO2"] / stats.totalMax) * 50;
			if (size > 0){
				return size;
			}
			else {
				return 3;
			}
		}
	</script>
</body>

</html>